// Generated by CoffeeScript 1.6.3
(function() {
  var Beat, beat, members;

  Beat = (function() {
    function Beat() {
      var interval, logo, offset,
        _this = this;
      logo = $("#logo");
      offset = logo.offset();
      this.paper = Raphael(offset.left + 133, offset.top - 73, 225, 270);
      this.animating = false;
      interval = setInterval(function() {
        if (!_this.animating) {
          return _this.donzDaz();
        }
      }, 12000);
      setTimeout(function() {
        return _this.donzDaz();
      }, 1200);
    }

    Beat.prototype.donzDaz = function() {
      this.times = 4;
      this.animating = true;
      return this.donz();
    };

    Beat.prototype.donz = function() {
      var circle, circle2,
        _this = this;
      circle = this.paper.circle(112, 109, 27);
      circle.attr({
        stroke: 'rgb(70, 169, 201)',
        fill: 'transparent',
        'stroke-width': 7
      });
      circle.animate({
        r: 65,
        stroke: '#CCC',
        opacity: 0
      }, 2800, 'ease-out');
      circle2 = this.paper.circle(101, 177, 27);
      circle2.attr({
        stroke: 'rgb(70, 169, 201)',
        fill: 'transparent',
        'stroke-width': 7
      });
      circle2.animate({
        r: 65,
        stroke: '#CCC',
        opacity: 0
      }, 2800, 'ease-out');
      if (this.times) {
        this.times -= 1;
        return setTimeout(function() {
          return _this.donz();
        }, 300 * this.times);
      } else {
        return this.animating = false;
      }
    };

    return Beat;

  })();

  beat = new Beat;

  members = $("#members");

  members.delegate('.member-meta1', 'webkitAnimationEnd mozAnimationEnd msAnimationEnd oAnimationEnd animationend', function(e) {
    var parent;
    parent = $(this).parent();
    if (parent.hasClass('animate-step4')) {
      parent.find('.member-meta2').css({
        position: '',
        left: '',
        top: ''
      });
      return parent.removeClass('animate-step1 animate-step2 animate-step3 animate-step4');
    } else {
      return parent.addClass('animate-step1');
    }
  });

  members.delegate('.member-meta2', 'webkitAnimationEnd mozAnimationEnd msAnimationEnd oAnimationEnd animationend', function(e) {
    var $this, offset, parent;
    parent = $(this).parent();
    if (parent.hasClass('animate-step3')) {
      return parent.addClass('animate-step4');
    } else {
      parent.addClass('animate-step2');
      $this = $(this);
      offset = $this.offset();
      console.dir(offset);
      $this.css({
        position: 'absolute',
        left: offset.left,
        top: offset.top - 140,
        zIndex: 8
      });
      return $this.data('offset', {
        left: offset.left,
        top: offset.top - 140
      });
    }
  });

  members.delegate('li[data-member]', 'mouseenter', function(e) {
    return $(this).data('hover', true);
  });

  members.delegate('li[data-member]', 'mouseleave', function(e) {
    var $this, timeout,
      _this = this;
    $this = $(this);
    $this.data('hover', false);
    timeout = $this.data('timeout');
    if (timeout != null) {
      clearTimeout(timeout);
    }
    return $this.data('timeout', setTimeout(function() {
      if ($this.hasClass('animate-step2') && $this.data('hover') === false && !$this.find('.member-meta2').hasClass('active')) {
        return $this.addClass('animate-step3');
      }
    }, 3000));
  });

  members.delegate('.member-meta2:not(.active)', 'click', function(e) {
    var $this, scale;
    $this = $(this);
    scale = Math.ceil((window.outerWidth - 200) / 150);
    $this.addClass('active');
    $this.css({
      position: 'fixed',
      left: '46%',
      top: '50%',
      '-ms-transform': "scale(" + scale + ")",
      '-o-transform': "scale(" + scale + ")",
      '-moz-transform': "scale(" + scale + ")",
      '-webkit-transform': "scale(" + scale + ")",
      'transform': "scale(" + scale + ")",
      zIndex: 999
    });
    return members.data('activeInfo', $this);
  });

  members.delegate('.member-meta2.active', 'webkitTransitionEnd transitionend', function(e) {
    return $(this).addClass('actived');
  });

  $("body").on('click', function(e) {
    var activeInfo, offset;
    activeInfo = members.data('activeInfo');
    if ((activeInfo != null) && activeInfo.hasClass('actived') && e.target === document.body) {
      offset = activeInfo.data('offset');
      activeInfo.on('webkitTransitionEnd transitionend', function() {
        offset = activeInfo.data('offset');
        activeInfo.css({
          zIndex: '',
          position: 'absolute',
          left: offset.left,
          top: offset.top,
          '-ms-transform': '',
          '-o-transform': '',
          '-moz-transform': '',
          '-webkit-transform': '',
          'transform': ''
        });
        activeInfo.removeClass('active actived');
        return activeInfo.off('webkitTransitionEnd transitionend');
      });
      activeInfo.css({
        left: offset.left,
        top: offset.top,
        zIndex: 8,
        position: 'fixed',
        '-ms-transform': 'scale(1)',
        '-o-transform': 'scale(1)',
        '-moz-transform': 'scale(1)',
        '-webkit-transform': 'scale(1)',
        'transform': 'scale(1)'
      });
      return members.removeData('activeInfo');
    }
  });

}).call(this);
